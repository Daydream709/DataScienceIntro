<!DOCTYPE html><html><head>
      <title>赛马预测项目实验报告</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\ASUS\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="赛马预测项目实验报告">赛马预测项目实验报告 </h1>
<h2 id="1-项目概述">1. 项目概述 </h2>
<p>本项目是数据科学导论课程的大作业，选题为赛马预测。报告将详细介绍项目的组织结构、各代码文件功能、完整实施流程、数据科学知识应用及相关扩展内容。</p>
<p>本项目旨在通过数据科学方法，对赛马比赛结果进行预测，主要分为两个预测目标：预测马匹获得第一名（Top1）和预测马匹进入前三名（Top3）。项目采用了完整的数据科学流程，包括数据获取、数据导入数据库、数据清洗、特征工程、模型训练和结果分析等环节，最终实现了较高的预测准确率。</p>
<p><strong>特别声明</strong>：本项目为纯学习与研究性质的数据分析实践项目，旨在探索数据科学的应用，不涉及任何形式的博彩活动，本人坚决反对任何形式的博彩行为。</p>
<h2 id="2-项目组织结构">2. 项目组织结构 </h2>
<p>本项目采用了模块化的组织结构，将不同功能的代码和数据分离存储，便于维护和扩展。项目主要包含以下文件夹：</p>
<h3 id="21-项目根目录结构">2.1 项目根目录结构 </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>├── .venv/                 # 虚拟环境文件夹
├── Top1/                  # 预测马匹获得第一名的相关代码和数据
│   ├── data/              # 预处理后的训练和测试数据
│   │   ├── X_test_final.csv      # 测试集特征数据
│   │   ├── X_train_final.csv     # 训练集特征数据
│   │   ├── y_test_final.csv      # 测试集标签数据
│   │   └── y_train_final.csv     # 训练集标签数据
│   ├── result/            # 模型训练和预测结果
│   │   └── ...            # 模型训练结果文件(同Top3)
│   └── src/               # 源代码文件
│       ├── DataProcessing/       # 数据处理相关代码
│       │   ├── csv_encoding_cleaner.py           # CSV文件编码处理
│       │   ├── data_fetch.py                     # 赛马数据爬取
│       │   ├── horse_info_insert.py              # 马匹信息插入数据库
│       │   ├── horse_info_preprocessing.py        # 马匹信息预处理
│       │   ├── horse_race_data_clean.py          # 赛马比赛数据清洗
│       │   ├── horse_race_info_insert.py         # 赛马比赛信息插入数据库
│       │   ├── horse_race_obstacle_delete.py     # 删除障碍赛数据
│       │   └── race_info_insert.py               # 比赛基本信息插入数据库
│       ├── TuningTraining/       # 模型调优和训练代码
│       │   ├── blending_tuning_final.py           # Blending集成模型调优
│       │   ├── cat_tuning_final.py               # CatBoost模型调优
│       │   ├── lgbm_tuning_final.py              # LightGBM模型调优
│       │   ├── model_tabnet.py                   # TabNet模型调优和训练
│       │   ├── stacking_tuning_final.py          # Stacking集成模型调优
│       │   ├── stacking_validation.py            # Stacking模型验证
│       │   ├── xgb_tuning_final.py               # XGBoost模型调优
│       │   └── catboost_info/                    # CatBoost训练日志
│       ├── catboost_info/        # CatBoost训练日志
│       └── accuracy_test.py       # 模型准确率测试和评估
├── Top3/                  # 预测马匹进入前三名的相关代码和数据
│   ├── data/              # 原始数据和预处理后的训练测试数据
│   │   ├── 2016/          # 2016年的原始赛马数据
│   │   ├── 2017/          # 2017年的原始赛马数据
│   │   ├── 2018/          # 2018年的原始赛马数据
│   │   ├── X_test_final.csv      # 测试集特征数据
│   │   ├── X_train_final.csv     # 训练集特征数据
│   │   ├── y_test_final.csv      # 测试集标签数据
│   │   └── y_train_final.csv     # 训练集标签数据
│   ├── result/            # 模型训练和预测结果
│   │   ├── blending_top3_tuning_result/   # Blending集成模型结果
│   │   ├── cat_top3_tuning_result/        # CatBoost模型结果
│   │   ├── hit_rate_analysis/             # 命中率分析结果
│   │   ├── lgbm_top3_tuning_result/       # LightGBM模型结果
│   │   ├── stacking_top3_result/          # Stacking集成模型结果
│   │   ├── tabnet_top3_result/            # TabNet模型结果
│   │   └── xgb_top3_tuning_result/        # XGBoost模型结果
│   └── src/               # 源代码文件
│       ├── DataProcessing/       # 数据处理相关代码（与Top1相同）
│       │   ├── csv_encoding_cleaner.py           # CSV文件编码处理
│       │   ├── data_fetch.py                     # 赛马数据爬取
│       │   ├── horse_info_insert.py              # 马匹信息插入数据库
│       │   ├── horse_info_preprocessing.py        # 马匹信息预处理
│       │   ├── horse_race_data_clean.py          # 赛马比赛数据清洗
│       │   ├── horse_race_info_insert.py         # 赛马比赛信息插入数据库
│       │   ├── horse_race_obstacle_delete.py     # 删除障碍赛数据
│       │   └── race_info_insert.py               # 比赛基本信息插入数据库
│       ├── GeneralTraining/      # 一般模型训练代码
│       │   ├── model_blending_4.py               # Blending集成模型训练
│       │   ├── model_catboost.py                 # CatBoost模型训练
│       │   ├── model_lgbm.py                     # LightGBM模型训练
│       │   ├── model_stacking_4.py               # Stacking集成模型训练
│       │   ├── model_tabnet.py                   # TabNet模型训练
│       │   └── model_xgb.py                      # XGBoost模型训练
│       ├── TuningTraining/       # 模型调优和训练代码
│       │   ├── blending_tuning_final.py           # Blending集成模型调优
│       │   ├── cat_tuning_final.py               # CatBoost模型调优
│       │   ├── lgbm_tuning_final.py              # LightGBM模型调优
│       │   ├── model_tabnet.py                   # TabNet模型调优和训练
│       │   ├── stacking_tuning_final.py          # Stacking集成模型调优
│       │   ├── xgb_tuning_final.py               # XGBoost模型调优
│       │   └── catboost_info/                    # CatBoost训练日志
│       ├── catboost_info/        # CatBoost训练日志
│       └── accuracy_test.py       # 模型准确率测试和评估
└── README.md              # 项目说明文档
</code></pre><h3 id="22-核心文件夹功能说明">2.2 核心文件夹功能说明 </h3>
<h4 id="221-top1-和-top3-文件夹">2.2.1 Top1 和 Top3 文件夹 </h4>
<p>这两个文件夹分别对应两种不同的预测任务：</p>
<ul>
<li><strong>Top1/</strong>：专注于预测马匹获得<strong>第一名</strong>的任务</li>
<li><strong>Top3/</strong>：专注于预测马匹进入<strong>前三名</strong>的任务</li>
</ul>
<p>每个文件夹内部结构相似，均包含 <code>data/</code>、<code>result/</code> 和 <code>src/</code> 子文件夹。</p>
<h4 id="222-data-文件夹">2.2.2 data/ 文件夹 </h4>
<ul>
<li><strong>Top1/data/</strong>：存储<strong>预处理后</strong>的训练和测试数据，包括 X_train_final.csv、X_test_final.csv、y_train_final.csv、y_test_final.csv</li>
<li><strong>Top3/data/</strong>：
<ul>
<li>存储<strong>原始赛马数据</strong>，按<strong>年份</strong>分类（如 2016/ 文件夹包含 2016 年的所有比赛数据）</li>
<li>原始数据文件以 CSV 格式存储，文件名包含比赛日期、场地、场次等信息</li>
<li>同时包含<strong>预处理后</strong>的训练测试数据，与 Top1 相同</li>
</ul>
</li>
</ul>
<h4 id="223-result-文件夹">2.2.3 result/ 文件夹 </h4>
<ul>
<li>存储预测任务的模型<strong>训练结果</strong>和<strong>报告</strong></li>
<li>每个模型的结果文件夹包含<strong>训练报告</strong>、<strong>结果</strong>和<strong>可视化图表</strong></li>
</ul>
<h4 id="224-src-文件夹">2.2.4 src/ 文件夹 </h4>
<p>源代码文件夹，采用模块化设计，按功能分为不同的子文件夹：</p>
<ul>
<li><strong>DataProcessing/</strong>：<strong>数据处理</strong>相关代码，包括数据获取、清洗、预处理和特征工程</li>
<li><strong>GeneralTraining/</strong>：<strong>一般模型训练</strong>代码，实现了多种基础模型</li>
<li><strong>TuningTraining/</strong>：<strong>模型调优和训练</strong>代码，使用 Optuna 进行超参数调优</li>
<li><strong>catboost_info/</strong>：CatBoost 模型训练过程中生成的日志和信息（不重要）</li>
</ul>
<h2 id="3-代码文件功能说明">3. 代码文件功能说明 </h2>
<h3 id="31-数据处理模块dataprocessing">3.1 数据处理模块（DataProcessing/） </h3>
<h4 id="311-data_fetchpy">3.1.1 data_fetch.py </h4>
<ul>
<li><strong>主要功能</strong>：实现赛马<strong>数据</strong>的爬取功能</li>
<li><strong>核心算法</strong>：使用<strong>网络爬虫</strong>技术从 <strong>netkeiba</strong> 网站获取赛马数据</li>
<li><strong>关键实现</strong>：
<ul>
<li>实现了反爬机制，包括频率控制和请求头伪装</li>
<li>爬取了 从 2016-2025 共 10 年的 <strong>JRA 中央赛马数据</strong>，共 33002 场比赛，54171 匹赛马，455976 条完赛数据</li>
<li>将爬取的数据存储为 CSV 格式</li>
</ul>
</li>
</ul>
<h4 id="312-csv_encoding_cleanerpy">3.1.2 csv_encoding_cleaner.py </h4>
<ul>
<li><strong>路径</strong>：src/DataProcessing/csv_encoding_cleaner.py</li>
<li><strong>主要功能</strong>：处理 CSV 文件的<strong>编码</strong>问题，确保数据可以正确读取</li>
<li><strong>核心算法</strong>：检测并转换文件编码，处理<strong>乱码</strong>数据</li>
<li><strong>关键实现</strong>：
<ul>
<li>删除乱码数据（约 1400 条）</li>
<li>确保所有 CSV 文件使用<strong>统一的编码格式</strong>（UTF-8）</li>
</ul>
</li>
</ul>
<h4 id="313-数据库操作相关文件">3.1.3 数据库操作相关文件 </h4>
<ul>
<li><strong>horse_info_insert.py</strong>：将<strong>马匹信息</strong>插入数据库</li>
<li><strong>horse_race_info_insert.py</strong>：将<strong>赛马比赛信息</strong>插入数据库</li>
<li><strong>race_info_insert.py</strong>：将<strong>比赛基本信息</strong>插入数据库</li>
<li><strong>核心功能</strong>：实现数据从 CSV 文件到 MySQL 数据库的导入</li>
<li><strong>关键实现</strong>：
<ul>
<li>建立数据库连接</li>
<li>创建数据库表结构</li>
<li>批量插入数据</li>
<li>异常处理机制</li>
</ul>
</li>
</ul>
<h4 id="314-horse_race_data_cleanpy">3.1.4 horse_race_data_clean.py </h4>
<ul>
<li><strong>路径</strong>：src/DataProcessing/horse_race_data_clean.py</li>
<li><strong>主要功能</strong>：清洗赛马比赛数据</li>
<li><strong>核心算法</strong>：<strong>异常值</strong>检测和处理、<strong>重复数据</strong>删除</li>
<li><strong>关键实现</strong>：
<ul>
<li>删除赔率<strong>异常数据</strong>（接近 1000 条，赔率&gt;550）</li>
<li>处理<strong>缺失值和异常值</strong></li>
</ul>
</li>
</ul>
<h4 id="315-horse_race_obstacle_deletepy">3.1.5 horse_race_obstacle_delete.py </h4>
<ul>
<li><strong>路径</strong>：src/DataProcessing/horse_race_obstacle_delete.py</li>
<li><strong>主要功能</strong>：删除<strong>障碍赛</strong>数据</li>
<li><strong>核心算法</strong>：基于比赛类型的筛选</li>
<li><strong>关键实现</strong>：
<ul>
<li>删除障碍赛马比赛数据（接近 1000 条）</li>
<li>只保留速度赛马比赛数据用于后续分析</li>
</ul>
</li>
</ul>
<h4 id="316-horse_info_preprocessingpy">3.1.6 horse_info_preprocessing.py </h4>
<ul>
<li><strong>路径</strong>：src/DataProcessing/horse_info_preprocessing.py</li>
<li><strong>主要功能</strong>：对马匹基本信息进行<strong>预处理</strong></li>
<li><strong>核心算法</strong>：<strong>数据清洗</strong>、<strong>格式转换</strong>和<strong>特征提取</strong></li>
<li><strong>关键实现</strong>：
<ul>
<li>处理马匹性别、年龄等基本信息</li>
<li>转换数据类型，处理缺失值</li>
<li>进行特征工程，提取马匹组内相对特征、历史战绩特征</li>
</ul>
</li>
</ul>
<h3 id="32-模型训练模块">3.2 模型训练模块 </h3>
<h4 id="321-一般模型训练generaltraining">3.2.1 一般模型训练（GeneralTraining/） </h4>
<ul>
<li><strong>model_lgbm.py</strong>：实现 <strong>LightGBM</strong> 模型训练</li>
<li><strong>model_xgb.py</strong>：实现 <strong>XGBoost</strong> 模型训练</li>
<li><strong>model_catboost.py</strong>：实现 <strong>CatBoost</strong> 模型训练</li>
<li><strong>model_tabnet.py</strong>：实现 <strong>TabNet</strong> 深度学习模型训练</li>
<li><strong>model_blending_4.py</strong>：实现四种模型的 <strong>Blending</strong> 集成</li>
<li><strong>model_stacking_4.py</strong>：实现四种模型的 <strong>Stacking</strong> 集成</li>
</ul>
<h4 id="322-模型调优训练tuningtraining">3.2.2 模型调优训练（TuningTraining/） </h4>
<ul>
<li><strong>lgbm_tuning_final.py</strong>：使用 Optuna 对 <strong>LightGBM</strong> 模型进行超参数调优</li>
<li><strong>xgb_tuning_final.py</strong>：使用 Optuna 对 <strong>XGBoost</strong> 模型进行超参数调优</li>
<li><strong>cat_tuning_final.py</strong>：使用 Optuna 对 <strong>CatBoost</strong> 模型进行超参数调优</li>
<li><strong>model_tabnet.py</strong>：<strong>TabNet</strong> 模型调优和训练</li>
<li><strong>blening_tuning_final.py</strong>：<strong>Blending</strong> 集成模型调优</li>
<li><strong>stacking_tuning_final.py</strong>：<strong>Stacking</strong> 集成模型调优</li>
</ul>
<h4 id="323-accuracy_testpy">3.2.3 accuracy_test.py </h4>
<ul>
<li><strong>路径</strong>：src/accuracy_test.py</li>
<li><strong>主要功能</strong>：<strong>模型准确率测试和评估</strong></li>
<li><strong>核心算法</strong>：计算某一模型的 AUC、准确率、F1 分数等评估指标</li>
<li><strong>关键实现</strong>：
<ul>
<li>加载训练好的模型和测试数据</li>
<li>进行预测并计算评估指标</li>
<li>生成评估报告</li>
</ul>
</li>
</ul>
<h2 id="4-项目实施步骤">4. 项目实施步骤 </h2>
<h3 id="41-数据获取">4.1 数据获取 </h3>
<h4 id="411-数据来源">4.1.1 数据来源 </h4>
<p>本项目的数据来源于日本中央赛马会（JRA）的公开数据，通过网络爬虫从 netkeiba 网站获取。该网站提供了详细的赛马比赛数据，包括马匹信息、比赛结果、赔率等。</p>
<h4 id="412-数据获取方法">4.1.2 数据获取方法 </h4>
<ul>
<li><strong>爬虫技术</strong>：使用 Python 编写<strong>爬虫程序</strong>，通过请求网站比赛数据网页，使用 <strong>XPath</strong> 提取数据</li>
<li><strong>反爬措施</strong>：
<ul>
<li>实现了请求频率控制</li>
<li>伪装请求头，模拟浏览器行为</li>
<li>采用分布式爬取策略，提高爬取效率</li>
<li>分多次请求，避免被封禁</li>
</ul>
</li>
</ul>
<h4 id="413-数据规模和字段">4.1.3 数据规模和字段 </h4>
<ul>
<li><strong>数据规模</strong>：爬取了 10 年的 JRA 中央赛马数据，共 <strong>33002 场比赛</strong>，<strong>54171 匹赛马</strong>，<strong>438536 条完赛数据</strong></li>
<li><strong>包含字段</strong>：
<ul>
<li>马匹信息：马匹 ID、姓名、性别、年龄、体重等</li>
<li>比赛信息：比赛 ID、日期、场地、距离、天气、赛道状态等</li>
<li>比赛结果：名次、时间、骑手、负重、赔率、人气等</li>
</ul>
</li>
</ul>
<h3 id="42-数据导入数据库">4.2 数据导入数据库 </h3>
<h4 id="421-数据库选择">4.2.1 数据库选择 </h4>
<p>本项目选择 <strong>MySQL</strong> 作为数据库，主要考虑以下因素：</p>
<ul>
<li>关系型数据适合存储结构化的赛马数据</li>
<li>MySQL 具有良好的性能和稳定性</li>
</ul>
<h4 id="422-数据库表结构设计">4.2.2 数据库表结构设计 </h4>
<p>项目设计了三个核心表：</p>
<ol>
<li>
<p><strong>horse</strong>表：存储<strong>马匹基本信息</strong></p>
<ul>
<li>horse_name：马匹名称，作为马匹唯一标识和 horse 表的主键（根据赛马命名规则，十年内不会出现重名马）</li>
<li>gender：性别</li>
<li>其他马匹相关属性</li>
</ul>
</li>
<li>
<p><strong>race</strong>表：存储<strong>比赛基本信息</strong></p>
<ul>
<li>race_id：比赛唯一标识</li>
<li>venue_type：比赛场地类型（ダ、芝）</li>
<li>distance：比赛距离</li>
<li>weather：天气(晴、曇、小雨、雨、小雪、雪)</li>
<li>track_status：赛道状态（良、不良、稍重、重）</li>
<li>direction：比赛方向（左、右）</li>
</ul>
</li>
<li>
<p><strong>horse_race</strong>表：存储<strong>马匹参赛结果</strong></p>
<ul>
<li>hr_id：记录唯一标识</li>
<li>horse_id：马匹 ID（外键）</li>
<li>race_id：比赛 ID（外键）</li>
<li>finish_rank：完赛名次</li>
<li>win_odds：获胜赔率</li>
<li>popularity：人气排名</li>
<li>jockey：骑手</li>
<li>weight：负重</li>
<li>其他比赛结果相关属性</li>
</ul>
</li>
</ol>
<h4 id="423-数据导入流程">4.2.3 数据导入流程 </h4>
<ol>
<li>读取 CSV 数据</li>
<li>建立 MySQL 数据库连接</li>
<li>创建数据库表结构</li>
<li>批量插入数据到对应表中</li>
</ol>
<h3 id="43-数据清洗">4.3 数据清洗 </h3>
<h4 id="431-原始数据问题">4.3.1 原始数据问题 </h4>
<ul>
<li><strong>乱码数据</strong>：部分 CSV 文件存在编码问题，导致数据<strong>乱码</strong></li>
<li><strong>障碍赛数据</strong>：包含<strong>障碍赛数据</strong>，与速度赛马数据特征差异较大</li>
<li><strong>异常赔率数据</strong>：部分<strong>比赛赔率异常高</strong>（&gt;550）</li>
<li><strong>缺失值</strong>：部分字段可能存在<strong>缺失值</strong></li>
<li><strong>重复数据</strong>：可能存在少量<strong>重复记录</strong></li>
</ul>
<h4 id="432-清洗方法和策略">4.3.2 清洗方法和策略 </h4>
<ol>
<li><strong>乱码数据处理</strong>：使用 csv_encoding_cleaner.py <strong>检测并删除乱码数据</strong>，约删除 1400 场比赛数据</li>
<li><strong>障碍赛数据处理</strong>：使用 horse_race_obstacle_delete.py <strong>删除障碍赛数据</strong>，约删除 1000 场比赛数据</li>
<li><strong>异常赔率处理</strong>：使用 horse_race_data_clean.py <strong>删除赔率&gt;550 的数据</strong>，约删除 1000 条马匹完赛数据</li>
<li><strong>缺失值处理</strong>：
<ul>
<li>数值列：优先用同场赛事的均值填充，若仍有缺失则用全局均值</li>
<li>类别列：填充列的众数</li>
</ul>
</li>
<li><strong>重复数据处理</strong>：使用 pandas 的 drop_duplicates()方法删除重复记录</li>
</ol>
<p>（实际上没有出现缺失值和重复数据）</p>
<h3 id="44-数据预处理与特征工程">4.4 数据预处理与特征工程 </h3>
<h4 id="441-数据预处理步骤">4.4.1 数据预处理步骤 </h4>
<ol>
<li><strong>数据标准化/归一化</strong>：对数值型特征进行标准化处理，使其均值为 0，方差为 1</li>
<li><strong>数据类型转换</strong>：将文本型数据转换为类别型数据</li>
<li><strong>去除掉不需要的特征</strong>：去除掉赔率特征（难以用于赛前预测），去除掉完赛时间特征（数据泄露）等等</li>
</ol>
<h4 id="442-特征工程实施">4.4.2 特征工程实施 </h4>
<ol>
<li>
<p><strong>组内相对特征构建</strong>：</p>
<ul>
<li>weight_vs_mean：单马骑手负重 - 本场平均负重</li>
<li>win_rate_vs_race_avg：单马胜率 - 本场平均胜率</li>
<li>top3_rate_vs_race_avg：单马前 3 名率 - 本场平均前 3 名率</li>
<li>...</li>
</ul>
</li>
<li>
<p><strong>历史特征计算</strong>：</p>
<ul>
<li>history_race_count：该马历史参赛场数</li>
<li>history_top3_count：历史前 3 名次数</li>
<li>history_avg_rank：历史平均排名</li>
<li>history_win_rate：历史胜率</li>
<li>...</li>
</ul>
</li>
<li>
<p><strong>交互特征与变换</strong>：</p>
<ul>
<li>weight_per_dist：骑手负重 /（赛事距离 / 1000）</li>
</ul>
</li>
<li>
<p><strong>类别特征编码</strong>：</p>
<ul>
<li>对性别（gender）、场地类型（venue_type）、赛道方向（direction）等做独热编码</li>
</ul>
</li>
<li>
<p><strong>标签生成</strong>：</p>
<ul>
<li>Top1 任务：将 finish_rank == 1 设为 1，其余设为 0</li>
<li>Top3 任务：将 finish_rank &lt;= 3 设为 1，其余设为 0</li>
</ul>
</li>
<li>
<p><strong>时序切分</strong>：</p>
<ul>
<li>严格按赛事时序切分，80%前的赛事为训练集，20%后为测试集</li>
<li>避免时间泄露，确保模型训练时不会使用未来数据</li>
<li>符合真实赛马预测场景：
<ul>
<li>训练集：<strong>历史数据</strong>，用于模型训练</li>
<li>测试集：<strong>最新数据</strong>，模拟真实预测场景</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="45-模型训练">4.5 模型训练 </h3>
<h4 id="451-模型选择">4.5.1 模型选择 </h4>
<p>本项目选择了多种机器学习模型进行比较和集成，包括：</p>
<ol>
<li><strong>LightGBM</strong>：基于梯度提升决策树的算法，具有高效、低内存占用的特点</li>
<li><strong>XGBoost</strong>：经典的梯度提升算法，具有良好的预测性能</li>
<li><strong>CatBoost</strong>：支持类别特征的梯度提升算法，减少了特征工程的工作量</li>
<li><strong>TabNet</strong>：基于注意力机制的深度学习模型，适合处理表格数据</li>
</ol>
<h4 id="452-模型训练过程">4.5.2 模型训练过程 </h4>
<ol>
<li>
<p><strong>数据划分</strong>：</p>
<ul>
<li>训练集：80%的历史赛事数据</li>
<li>测试集：20%的最新赛事数据</li>
</ul>
</li>
<li>
<p><strong>超参数调优</strong>：</p>
<ul>
<li>使用 Optuna 库进行超参数调优</li>
<li>针对每个模型设置不同的搜索空间</li>
<li>以 AUC 作为主要评价指标</li>
</ul>
</li>
<li>
<p><strong>模型集成</strong>：</p>
<ul>
<li><strong>Blending</strong>：将多个模型的预测结果进行加权平均</li>
<li><strong>Stacking</strong>：使用元模型对基础模型的预测结果进行再训练</li>
</ul>
</li>
<li>
<p><strong>训练监控</strong>：</p>
<ul>
<li>记录模型训练过程中的损失函数变化</li>
<li>监控模型在验证集上的性能</li>
<li>防止过拟合</li>
</ul>
</li>
</ol>
<h3 id="46-结果分析">4.6 结果分析 </h3>
<h4 id="461-评估指标">4.6.1 评估指标 </h4>
<p>本项目主要使用以下评估指标：</p>
<ul>
<li><strong>AUC</strong>：ROC 曲线下面积，衡量模型的整体预测能力</li>
<li><strong>精确率</strong>：预测为正样本中实际为正样本的比例</li>
<li><strong>F1 分数</strong>：精确率和召回率的调和平均值</li>
</ul>
<h4 id="462-模型性能对比">4.6.2 模型性能对比 </h4>
<p>本项目针对两个预测目标分别进行了模型训练和评估，以下是两类模型的性能对比情况：</p>
<h5 id="4621-单胜top1模型性能对比">4.6.2.1 单胜（Top1）模型性能对比 </h5>
<p>单胜预测目标是预测马匹获得第一名的概率，以下是各模型在单胜预测任务上的真实性能表现：</p>
<table>
<thead>
<tr>
<th>模型</th>
<th>AUC</th>
<th>F1 分数</th>
<th>LogLoss</th>
<th>Best Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td>LightGBM</td>
<td>0.828256</td>
<td>0.362551</td>
<td>0.489453</td>
<td>0.7122</td>
</tr>
<tr>
<td>XGBoost</td>
<td>0.831369</td>
<td>0.367407</td>
<td>0.383545</td>
<td>0.6122</td>
</tr>
<tr>
<td>CatBoost</td>
<td>0.831947</td>
<td>0.367420</td>
<td>0.425966</td>
<td>0.6477</td>
</tr>
<tr>
<td>TabNet</td>
<td>0.829163</td>
<td>0.364085</td>
<td>0.209886</td>
<td>0.1976</td>
</tr>
<tr>
<td>Blending</td>
<td>0.831951</td>
<td>0.367680</td>
<td>0.391985</td>
<td>0.6124</td>
</tr>
<tr>
<td>Stacking</td>
<td>0.831813</td>
<td>0.367340</td>
<td>0.209285</td>
<td>0.1807</td>
</tr>
</tbody>
</table>
<p><strong>指标说明</strong>：</p>
<ul>
<li><strong>AUC</strong>：ROC 曲线下面积，衡量模型的整体预测能力</li>
<li><strong>F1 分数</strong>：精确率和召回率的调和平均值，综合衡量模型性能</li>
<li><strong>LogLoss</strong>：对数损失，衡量概率预测的准确性</li>
<li><strong>Best Threshold</strong>：最佳分类阈值，用于将概率转换为类别预测</li>
</ul>
<h5 id="4622-前三top3模型性能对比">4.6.2.2 前三（Top3）模型性能对比 </h5>
<p>前三预测目标是预测马匹进入前三名的概率，以下是各模型在前三预测任务上的真实性能表现：</p>
<table>
<thead>
<tr>
<th>模型</th>
<th>AUC</th>
<th>F1 分数</th>
<th>LogLoss</th>
<th>Best Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td>LightGBM</td>
<td>0.811574</td>
<td>0.553304</td>
<td>0.561226</td>
<td>0.6182</td>
</tr>
<tr>
<td>XGBoost</td>
<td>0.814892</td>
<td>0.557099</td>
<td>0.467971</td>
<td>0.4944</td>
</tr>
<tr>
<td>CatBoost</td>
<td>0.814937</td>
<td>0.555927</td>
<td>0.485584</td>
<td>0.5216</td>
</tr>
<tr>
<td>TabNet</td>
<td>0.811262</td>
<td>0.556502</td>
<td>0.537075</td>
<td>0.5710</td>
</tr>
<tr>
<td>Blending</td>
<td>0.815020</td>
<td>0.556735</td>
<td>0.478347</td>
<td>0.5188</td>
</tr>
<tr>
<td>Stacking</td>
<td>0.814691</td>
<td>0.556605</td>
<td>0.412087</td>
<td>0.2826</td>
</tr>
</tbody>
</table>
<p><strong>指标说明</strong>：</p>
<ul>
<li><strong>AUC</strong>：ROC 曲线下面积，衡量模型的整体预测能力</li>
<li><strong>F1 分数</strong>：精确率和召回率的调和平均值，综合衡量模型性能</li>
<li><strong>LogLoss</strong>：对数损失，衡量概率预测的准确性</li>
<li><strong>Best Threshold</strong>：最佳分类阈值，用于将概率转换为类别预测</li>
</ul>
<h4 id="463-结果可视化">4.6.3 结果可视化 </h4>
<h5 id="4631-单胜top1模型结果可视化">4.6.3.1 单胜（Top1）模型结果可视化 </h5>
<ol>
<li>
<p><strong>基础模型图表</strong></p>
<ul>
<li><strong>ROC 曲线对比</strong>：展示各模型在单胜预测任务上的 ROC 曲线，各模型的曲线极为接近，AUC 均在 0.83 左右</li>
<li><strong>特征重要性分析</strong>：分析各模型的特征重要性，pop_rank、popularity、pop_vs_mean 等特征在单胜预测中具有较高的重要性</li>
<li><strong>Precision-Recall 曲线对比</strong>：展示各模型在单胜预测任务上的 Precision-Recall 曲线</li>
<li><strong>LightGBM</strong>:<img src="./Top1/result/lgbm_tuning_result/lgbm_tuned_dashboard.png" alt=""></li>
<li><strong>XGBoost</strong>:<img src="./Top1/result/xgb_tuning_result/xgb_tuned_dashboard.png" alt=""></li>
<li><strong>CatBoost</strong>:<img src="./Top1/result/cat_tuning_result/cat_tuned_dashboard.png" alt=""></li>
<li><strong>TabNet</strong>:<img src="./Top1/result/tabnet_result/tabnet_dashboard.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>Blending 模型相关图表</strong></p>
<ul>
<li><strong>Blending 模型权重分配</strong>：展示 Blending 集成模型中各基础模型的权重分配情况，CatBoost 权重占比最大，达 80%。LGBM 权重最小，仅为 1%<br>
<img src="./Top1/result/blending_tuning_result/optimized_weights_pie.png" alt=""></li>
<li><strong>基础模型相关性分析</strong>：展示各基础模型之间的相关性，可见三个机器学习模型的相关性极高，而深度学习模型与其他几个模型的相关性较低<br>
<img src="./Top1/result/blending_tuning_result/model_correlation_heatmap.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>Stacking 模型相关图表</strong>：</p>
<ul>
<li><strong>ROC 曲线对比</strong>：展示各模型在单胜预测任务上的 ROC 曲线，各模型的曲线极为接近，AUC 均在 0.83 左右</li>
<li><strong>Precision-Recall 曲线对比</strong>：展示各模型在单胜预测任务上的 Precision-Recall 曲线</li>
<li><strong>Stacking 模型权重分配</strong>：展示 Stacking 集成模型中各基础模型的权重分配情况，XGBoost 和 CatBoost 权重较高<br>
<img src="./Top1/result/stacking_tuning_result/stacking_dashboard.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>模型准确率图表</strong><br>
<img src="./Top1/result/hit_rate_analysis/models_accuracy_comparison.png" alt=""></p>
</li>
</ol>
<h5 id="4632-前三top3模型结果可视化">4.6.3.2 前三（Top3）模型结果可视化 </h5>
<ol>
<li>
<p><strong>基础模型图表</strong></p>
<ul>
<li><strong>ROC 曲线对比</strong>：展示各模型在单胜预测任务上的 ROC 曲线，各模型的曲线极为接近，AUC 均在 0.83 左右</li>
<li><strong>特征重要性分析</strong>：分析各模型的特征重要性，pop_rank、popularity、pop_vs_mean 等特征在单胜预测中具有较高的重要性</li>
<li><strong>Precision-Recall 曲线对比</strong>：展示各模型在单胜预测任务上的 Precision-Recall 曲线</li>
<li><strong>LightGBM</strong>:<img src="./Top3/result/lgbm_top3_tuning_result/lgbm_tuned_dashboard_top3.png" alt=""></li>
<li><strong>XGBoost</strong>:<img src="./Top3/result/xgb_top3_tuning_result/xgb_tuned_dashboard_top3.png" alt=""></li>
<li><strong>CatBoost</strong>:<img src="./Top3/result/cat_top3_tuning_result/cat_tuned_dashboard_top3.png" alt=""></li>
<li><strong>TabNet</strong>:<img src="./Top3/result/tabnet_top3_result/tabnet_metrics_dashboard_top3.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>Blending 模型相关图表</strong></p>
<ul>
<li><strong>Blending 模型权重分配</strong>：展示 Blending 集成模型中各基础模型的权重分配情况，CatBoost 权重占比最大，达 55.2%；XGBoost 占比 42.9%，Tabnet 权重较小，约为 1.8%,LGBM 权重最小，仅为 0.1%<br>
<img src="./Top3/result/blending_top3_tuning_result/top3_weights_pie.png" alt=""></li>
<li><strong>基础模型相关性分析</strong>：展示各基础模型之间的相关性<br>
<img src="./Top3/result/blending_top3_tuning_result/top3_model_correlation_heatmap.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>Stacking 模型相关图表</strong>：</p>
<ul>
<li><strong>Stacking 模型权重分配</strong>：各个模型权重相近<br>
<img src="./Top3/result/stacking_top3_result/meta_model_weights_top3.png" alt=""></li>
</ul>
</li>
<li>
<p><strong>模型准确率图表</strong><br>
<img src="./Top3/result/hit_rate_analysis/models_accuracy_comparison.png" alt=""></p>
</li>
</ol>
<h4 id="464-模型优势与不足">4.6.4 模型优势与不足 </h4>
<h5 id="4641-单胜top1模型优势与不足">4.6.4.1 单胜（Top1）模型优势与不足 </h5>
<p><strong>优势</strong>：</p>
<ul>
<li>各模型的 AUC 表现<strong>较为接近</strong>，均在 0.828-0.832 之间，整体预测能力<strong>较强</strong></li>
<li><strong>CatBoost</strong> 和 <strong>Blending</strong> 模型的 AUC 略高于其他模型，分别为 0.831947 和 0.831951</li>
<li><strong>TabNet</strong> 和 <strong>Stacking</strong> 模型的 LogLoss 最低，分别为 0.209886 和 0.209285，概率预测准确性最高</li>
<li><strong>集成模型</strong>（Blending 和 Stacking）表现稳定，整体性能优于或接近最佳单个模型</li>
<li><strong>所有模型</strong>的准确率均在 33.7% 左右，预测准确率已经达到可用的级别</li>
</ul>
<p><strong>不足</strong>：</p>
<ul>
<li>所有模型的 <strong>F1 分数均较低</strong>，最高仅为 0.367420（CatBoost），预测准确性仍有较大提升空间</li>
<li><strong>LightGBM</strong> 模型的 LogLoss 较高（0.489453），概率预测准确性较差</li>
<li>最佳分类阈值差异较大，从 0.1976（TabNet）到 0.7122（LightGBM）不等，说明模型的概率分布特征有差异</li>
<li>单胜预测难度较大，受随机因素影响较大</li>
</ul>
<h5 id="4642-前三top3模型优势与不足">4.6.4.2 前三（Top3）模型优势与不足 </h5>
<p><strong>优势</strong>：</p>
<ul>
<li>各模型的 AUC 表现<strong>较为接近</strong>，均在 0.81 左右，整体预测能力较强</li>
<li><strong>Stacking</strong> 模型的 LogLoss 最低（0.412087），概率预测准确性最高</li>
<li><strong>XGBoost</strong> 和 <strong>CatBoost</strong> 模型的 AUC 略高于其他模型，分别为 0.814892 和 0.814937</li>
<li>各类模型之间的 <strong>F1 分数差异较小</strong>，均在 0.55-0.56 之间</li>
<li><strong>所有模型</strong>的首选马进前三率均在 65%左右，预测前三的马中，真实前三的概率在 53%左右，有着不俗的准确率表现</li>
</ul>
<p><strong>不足</strong>：</p>
<ul>
<li>所有模型的 F1 分数均未超过 0.56，预测准确性仍有提升空间</li>
<li><strong>LightGBM</strong> 模型的 LogLoss 较高（0.561226），概率预测准确性较差</li>
<li>最佳分类阈值差异较大，说明模型的概率分布特征不同</li>
</ul>
<h4 id="465-模型训练结果中的一些现象">4.6.5 模型训练结果中的一些现象 </h4>
<ul>
<li>综合来看，在单胜与前三预测中，<strong>Stacking</strong> 模型的表现都是<strong>最好</strong>的，虽然 AUC 略低于 Catboost 结果，但是 LogLoss 优势极大，说明 stacking 模型在概率预测方面更加强大</li>
<li><strong>LightGBM</strong> 模型使用的特征权重与其他模型有较显著的不同，其他模型基本都以<strong>人气</strong>为主要依据，而 LGBM 模型则更关注<strong>组内相对特征</strong></li>
<li><strong>TabNet</strong> 模型和 <strong>Stacking</strong> 模型的 LogLoss <strong>显著低于</strong>其他模型，虽然 AUC 略低，但综合来看<strong>表现更优</strong>，这是因为：
<ul>
<li><strong>TabNet</strong> 直接学习概率分布，而非硬分类，<strong>适合</strong> LogLoss 指标的优化</li>
<li><strong>Stacking</strong> 模型集成了 LGBM、XGBoost、CatBoost 和 TabNet 不同类型的模型,使用 Logistic Regression 作为元模型，学习基础模型预测结果的<strong>最优组合</strong>，不同模型的偏差方向不同，集成后相互抵消，提高整体预测准确性</li>
</ul>
</li>
<li>optuna <strong>参数调优</strong>对模型的优化效果较好，GeneralTraining 文件夹中的未经参数调优的训练脚本在后续并没有使用</li>
<li>三个 GBDT 模型<strong>相关性极高</strong>，而深度学习模型 <strong>Tabnet</strong> 与这三个模型的<strong>相关性较低</strong>，这是因为：
<ul>
<li>三个 GBDT 模型之间<strong>算法原理</strong>相似，<strong>模型结构</strong>相近，对<strong>数据模式的学习偏好</strong>一致</li>
<li>而 <strong>TabNet</strong> 的<strong>算法原理</strong>本质不同，是一种基于注意力机制的深度神经网络，可能学习到 GBDT 模型忽略的隐性特征交互</li>
</ul>
</li>
<li>单胜预测和前三预测模型 <strong>blending</strong> 时使用的模型权重不同，且各个模型之间的相关性也有所改变，显然前三预测模型中各个模型之间的相关性相比单胜模型更低</li>
<li>单胜预测和前三预测模型 <strong>stacking</strong> 时使用的模型权重不同</li>
</ul>
<h2 id="5-数据科学知识应用">5. 数据科学知识应用 </h2>
<p>本项目综合应用了多种数据科学知识和技术，紧密结合数据科学导论课堂教学与实验内容：</p>
<h3 id="51-数据库技术">5.1 数据库技术 </h3>
<ul>
<li><strong>数据库设计</strong>：设计了合理的数据库表结构，实现了数据的规范化存储</li>
<li><strong>SQL 查询</strong>：使用 SQL 语句进行数据查询和分析</li>
<li><strong>数据存储与管理</strong>：将大量赛马数据高效存储和管理</li>
</ul>
<h3 id="52-数据处理技术">5.2 数据处理技术 </h3>
<ul>
<li><strong>数据清洗</strong>：处理了乱码、异常值、缺失值等问题</li>
<li><strong>特征工程</strong>：
<ul>
<li>特征选择：选择对预测结果有重要影响的特征</li>
<li>特征提取：从原始数据中提取有用信息</li>
<li>特征转换：对特征进行变换，提高模型性能</li>
<li>新特征构造：构建了组内相对特征和历史特征</li>
</ul>
</li>
</ul>
<h3 id="53-机器学习">5.3 机器学习 </h3>
<ul>
<li><strong>模型原理</strong>：深入理解了 LightGBM、XGBoost、CatBoost、TabNet 等模型的原理</li>
<li><strong>参数调优</strong>：使用 Optuna 进行高效的超参数调优</li>
</ul>
<h3 id="54-数据可视化技术">5.4 数据可视化技术 </h3>
<ul>
<li><strong>图表选择</strong>：根据不同的分析目的选择合适的图表类型</li>
<li><strong>可视化工具</strong>：使用 Matplotlib、Seaborn 等库进行数据可视化</li>
<li><strong>结果展示</strong>：将复杂的模型结果以直观的方式展示</li>
</ul>
<h2 id="6-相关内容">6. 相关内容 </h2>
<h3 id="61-项目中遇到的挑战及解决方案">6.1 项目中遇到的挑战及解决方案 </h3>
<ol>
<li>
<p><strong>数据获取困难</strong>：</p>
<ul>
<li><strong>挑战</strong>：网站有反爬机制，频繁爬取会被封 IP</li>
<li><strong>解决方案</strong>：采取反爬措施，利用多个 IP 地址爬取数据</li>
</ul>
</li>
<li>
<p><strong>数据质量问题</strong>：</p>
<ul>
<li><strong>挑战</strong>：原始爬取数据存在大量乱码、异常值和缺失值</li>
<li><strong>解决方案</strong>：设计了多步骤的数据清洗流程，使用自动化脚本处理数据</li>
</ul>
</li>
<li>
<p><strong>特征工程复杂</strong>：</p>
<ul>
<li><strong>挑战</strong>：赛马数据特征众多，如何选择和构造有效特征是关键</li>
<li><strong>解决方案</strong>：结合领域知识和特征重要性分析，构建了组内相对特征和历史特征</li>
</ul>
</li>
<li>
<p><strong>模型选择与调优</strong>：</p>
<ul>
<li><strong>挑战</strong>：不同模型的超参数众多，调优过程耗时</li>
<li><strong>解决方案</strong>：使用 Optuna 进行自动化超参数调优，提高了调优效率</li>
</ul>
</li>
</ol>
<h3 id="62-与其他赛马预测方法的对比分析">6.2 与其他赛马预测方法的对比分析 </h3>
<p>与传统的赛马经验预测方法相比，本项目的优势在于：</p>
<ol>
<li><strong>数据规模大</strong>：使用了 10 年的历史数据，共 33002 场比赛</li>
<li><strong>特征工程丰富</strong>：构建了多种类型的特征，包括组内相对特征和历史特征</li>
<li><strong>使用现代科学手段</strong>：使用机器学习算法分析数据，得到更为准确的结果</li>
<li><strong>评估体系完善</strong>：使用多种评估指标全面评估模型性能</li>
</ol>
<h3 id="63-模型的局限性及未来改进方向">6.3 模型的局限性及未来改进方向 </h3>
<p><strong>局限性</strong>：</p>
<ol>
<li><strong>特征局限性</strong>：未考虑马匹的血统、训练情况等深层次特征，无法获取待预测比赛的终盘赔率（赔率在闭盘前会有较大波动，难以实时获取，故虽然赛后可以获取，但并没有作为特征参与训练），无法获取妈的步长、步频等生理特征（保密数据），这些特征对预测结果有重要影响</li>
<li><strong>数据实时性</strong>：现有模型与脚本只能基于历史数据进行预测，无法实时获取最新数据</li>
</ol>
<p><strong>未来改进方向</strong>：</p>
<ol>
<li><strong>引入更多特征</strong>：考虑引入马匹血统、训练情况、骑手历史表现等特征</li>
<li><strong>实时数据更新</strong>：实现实时数据爬取和模型更新</li>
</ol>
<h3 id="64-项目实施过程中的经验总结与心得体会">6.4 项目实施过程中的经验总结与心得体会 </h3>
<ol>
<li><strong>数据质量是关键</strong>：高质量且大量的数据是构建高性能模型的基础，数据获取、数据清洗和预处理工作至关重要</li>
<li><strong>特征工程决定上限</strong>：好的特征工程可以显著提高模型性能，需要结合领域知识和数据分析<br>
最开始的模型训练没有使用组内相对特征和历史特征，仅使用了基础特征，模型性能较低，AUC 指标低于 0.8，在添加组内相对特征和历史特征后，模型性能有了显著提高</li>
<li><strong>模型集成效果更佳</strong>：不同模型的集成通常可以获得比单个模型更好的性能（blending 与 stacking 获得的模型性能均较优）</li>
<li><strong>避免数据泄露</strong>：在模型训练过程中要特别注意避免数据泄露（完赛时间、排名、冲刺时间、阶段时间等）</li>
<li><strong>自动化工具提高效率</strong>：使用 Optuna 等自动化工具可以提高超参数调优的效率</li>
</ol>
<h2 id="7-结论">7. 结论 </h2>
<p>本项目成功实现了赛马预测系统，通过完整的数据科学流程，从数据获取到模型部署，构建了高性能的赛马预测模型。项目的主要成果包括：</p>
<ol>
<li><strong>完整的数据处理链</strong>：实现了从数据获取、清洗、预处理到特征工程的全流程</li>
<li><strong>多种模型的比较和集成</strong>：比较了 LightGBM、XGBoost、CatBoost、TabNet 等模型，并实现了 Blending 和 Stacking 集成</li>
<li><strong>高性能的预测模型</strong>：集成模型的 AUC 均大于 0.8，具有较好的预测能力</li>
<li><strong>详细的结果分析</strong>：对模型性能进行了评估和分析，为后续改进提供了方向</li>
</ol>
<p>本项目展示了数据科学在赛马预测领域的应用潜力，通过合理的特征工程和模型选择，可以实现较高的预测准确率。同时，项目也揭示了赛马预测的复杂性和挑战性，需要持续的优化和改进。</p>
<p>未来，随着更多数据源的引入和模型技术的发展，赛马预测系统的性能有望进一步提升</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>